<!DOCTYPE html>
<html>
  <head>
    <title>Audio Recorder</title>
  </head>
  <body>
    <h1>Audio Recorder</h1>
    <button id="startBtn">Start Meeting</button>
    <button id="stopBtn" disabled>Stop Meeting</button>
    <script>
      const startBtn = document.getElementById("startBtn");
      const stopBtn = document.getElementById("stopBtn");
      let recorder, audioChunks, mediaRecorder;

      startBtn.addEventListener("click", async () => {
        startBtn.disabled = true;
        stopBtn.disabled = false;

        audioChunks = [];
        const mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(mediaStream);

        mediaRecorder.addEventListener("dataavailable", (event) => {
          audioChunks.push(event.data);
        });

        mediaRecorder.start();
      });

      stopBtn.addEventListener("click", () => {
        stopBtn.disabled = true;
        startBtn.disabled = false;

        mediaRecorder.stop();
        mediaRecorder.addEventListener("stop", async () => {
          const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
          const formData = new FormData();
          formData.append("file", audioBlob, "audio.wav");

          // Update the API route to "/upload"
          const response = await fetch("/upload", { method: "POST", body: formData });
          const data = await response.json();

          console.log("Transcription:", data.transcription);
          console.log("Summary:", data.summary);
        });
      });
    </script>
  </body>
</html>
